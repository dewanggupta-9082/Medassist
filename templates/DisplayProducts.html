<!DOCTYPE html>
<link href="/static/product.css"   rel="stylesheet">
<html lang="en">
<head>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

      <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/project.js"></script>

    <meta charset="UTF-8">

    <title>Display Products</title>

</head>
<body>

<div class="maincontainer">

        <div class="box" style="padding: 20px;">

            <div class="boxheading">
                <span style="padding-left: 5px;padding-right: 40px;">
                    <a href="http://localhost:8000/productinterface"><i class="material-icons left"  style="color: white;">add_box</i></a>

                </span>
                <span class="headingtext" style="padding-left: 300px">Product List</span>
            </div>

            <table class="responsive-table striped centered">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Sub Category</th>
                        <th>Brand Id</th>
                        <th>Product Name</th>
                        <th>Packing Type</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Offer Price</th>
                        <th>Rating</th>
                        <th>Status</th>
                        <th>Product Image</th>
                        <th>Update</th>
                    </tr>
                </thead>

                <tbody>
                 <tbody>
                    {% for row in records %}
                    <tr>
                        <td> {{ row.cname }} [{{ row.categoryid }}]</td>
                        <td> {{row.scname }} [{{ row.subcategoryid }}] </td>
                        <td> {{ row.bid }} [{{ row.brandid }}] </td>
                        <td>{{ row.productname }}</td>
                        <td>{{ row.packingtype }}</td>
                        <td>{{ row.quantity }}</td>
                        <td>{{ row.price }}</td>
                        <td>{{ row.offerprice }}</td>
                        <td>{{ row.rating }}</td>
                        <td>{{ row.status }}</td>
                        <td><img src="/static/{{ row.productimage }}" width='40' class="imgbtn"
                                piconid="{{ row.productid }}" pimage="{{ row.productimage }}"></td>
                        <td>
                            <a class="waves-effect waves-light btn modal-trigger editdelbtn" cid="{{ row.categoryid }}"
                                scid="{{ row.subcategoryid }}" bid="{{ row.brandid }}" pid="{{ row.productid }}"
                                pname="{{ row.productname }}" ptype="{{ row.packingtype }}" quant="{{ row.quantity }}"
                                pr="{{ row.price }}" opr="{{ row.offerprice }}" ratin="{{ row.rating }}" stat="{{ row.status }}"
                                sstat="{{ row.salestatus }}"
                                href="#modal1">Edit/Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                </tbody>
            </table>
        </div>
</div>

                   <div id="modal1" class="modal">
                       <div class="modal-content">

                        <input type="hidden" id="productid" value="{{row.productid}}">


                             <div class="modelbox">

             <div class="boxheading">
                <span style="font-size: 30px;font-weight: bold;">Product Interface</span>
             </div>

                            <div>
                    <div class="row">
                        <div class="input-field col s4">
                            <i class="material-icons prefix">account_circle</i>
                    <input required id="categoryid" name="categoryid" type="text" class="validate">
                            <label for="categoryid"> Category Id</label>

                        </div>

                        <div class="input-field col s4">
                            <i class="material-icons prefix">account_circle</i>
                    <input required id="subcategoryid" name="subcategoryid" type="text" class="validate">
                            <label for="subcategoryid"> SubCategory Id</label>

                        </div>

                        <div class="input-field col s4">
                            <i class="material-icons prefix">account_circle</i>
                    <input required id="brandid" name="brandid" type="text" class="validate">
                            <label for="brandid"> Brand Id</label>

                        </div>
                    </div>
                    <div class="row">

                        <div class="input-field col s4">
                            <i class="material-icons prefix">account_circle</i>
                            <input required id="productname" name="productname" type="text" class="validate">
                            <label for="productname">Product  Name</label>

                        </div>

                        <div class="input-field col s4">

                            <select id="packingtype" name="packingtype">

                             <option value="" disabled selected>Choose your option</option>
                                <option >Box</option>
                                <option >Strip</option>
                                <option >Sachets</option>
                                <option >Injections</option>
                                <option >Syrups</option>

                               </select>
                             <label for="packingtype">Packing Type</label>
                        </div>


                        <div class="input-field col s4">
                            <input required id="quantity" name="quantity" type="text" class="validate">
                            <label for="quantity">Quantity</label>

                        </div>

                    </div>

                    <div class="row">
                        <div class="input-field col s6">
                            <input required id="price" name="price" type="text" class="validate">
                            <label for="price">Price</label>

                        </div>
                        <div class="input-field col s6">
                            <input required id="offerprice" name="offerprice" type="text" class="validate">
                            <label for="offerprice">Offer Price</label>

                        </div>
                    </div>

                    <div class="row">

                        <div class="input-field col s4">
                           <select id="status" name="status">
                                <option value="" disabled selected>Choose your option</option>
                                <option value="Top">Top</option>
                                <option value="Trending">Trending</option>
                                <option value="Popular">Popular</option>
                                <option value="Discontinue">Discontinue</option>
                            </select>
                      <label for="status"> Status</label>

                        </div>
                        <div class="input-field col s4">
                            <input required id="rating" name="rating" type="text" class="validate">
                            <label for="rating">Rating</label>

                        </div>
                        <div class="input-field col s4">
                             <select id="salestatus" name="salestatus">
                                <option value="" disabled selected>Choose your option</option>
                                <option value="continue">Continue</option>
                                <option value="discontinue">Discontinue</option>
                            </select>
                            <label for="salestatus">Choose Sale Status</label>

                        </div>
                    </div>

                    <div class="row">
                            <div class="input-field col s12">
                            <div class="file-field input-field">
                                <div class="btn">
                                    <span>File</span>
                                    <input type="file" required name="productimage">
                                </div>
                                <div class="file-path-wrapper">
                                    <input class="file-path validate" type="text">
                                </div>
                            </div>

                        </div>

                    </div>


                    <div class="row">

                         <div class="col s6 btnrow">
                                 <button class="btn waves-effect waves-light btstyle edit" type="button" style="color: black;width: 80%;">Edit
                                    <i class="material-icons right" style="color: black">edit</i>
                                 </button>
                            </div>

                            <div class="col s6 btnrow">
                                   <button class="btn waves-effect waves-light btstyle delete" type="button" style="color: black;width: 80%;">Delete
                                    <i class="material-icons right"  style="color: black">delete</i>
                                  </button>
                            </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col s12 btnrow">
                        <span class="messagestyle">{{ message }}</span>
                    </div>
                </div>
                       </div>


                        <div class="modal-footer">
                     <a href="#!" class="modal-close waves-effect waves-green btn-flat btnclose">Close</a>
                 </div>
                   </div>
                   </div>

<!-- Modal Structure For Picture -->
<div id="modal2" class="modal">
    <div class="modal-content">
        <div style="padding: 10px;">
            <input type="hidden" id="icon_pid"/>
            <img id="icon" width="200"/>
        </div>
        <div style="padding: 15px;"><b>Select New Picture:</b></div>
        <div style="padding: 15px">
            <div class="file-field input-field">
                <div class="btn">
                    <span>File</span>
                    <input required type="file" id="newicon">
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate" type="text">
                </div>
            </div>

            <button class="btn waves-effect waves-light iconbtn">Edit Icon
                <i class="material-icons right">edit</i>
            </button>
            <a href="#!" class="waves-effect waves-green btn-flat btniconclose">Close</a>

        </div>
    </div>
</div>







</body>

  <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>




<script>

     $(document).ready(function() {

         $('#modal1').modal();
          $('#modal2').modal();


           $('#categoryid').val(' ')


         $('#productid').val(' ')
         $('#categoryid').val(' ')
         $('#subcategoryid').val(' ')
         $('#brandid').val(' ')
         $('#productname').val(' ')
         $('#packingtype').val(' ')
         $('#quantity').val(' ')
         $('#price').val(' ')
         $('#offerprice').val(' ')
         $('#rating').val(' ')
         $('#status').val(' ')
         $('#salestatus').val(' ')

          $('.editdelbtn').click(function () {
              alert('hello')

            $('#productid').val(($(this).attr('pid')))
            $('#categoryid').val(($(this).attr('cid')))
            $('#subcategoryid').val(($(this).attr('sid')))
              $('#brandid').val(($(this).attr('bid')))
            $('#productname').val(($(this).attr('pname')))
            $('#packingtype').val(($(this).attr('ptype')))
            $('#quantity').val(($(this).attr('quant')))
            $('#price').val(($(this).attr('pr')))
               $('#offerprice').val(($(this).attr('opr')))
               $('#rating').val(($(this).attr('ratin')))
               $('#status').val(($(this).attr('sat')))

    })

          $('.edit').click(function () {
          alert($('#productid').val())

          $.getJSON('http://localhost:8000/editproducts', {
              'categoryid': $('#categoryid').val(),
              'subcategoryid': $('#subcategoryid').val(),
               'brandid': $('#brandid').val(),
              'productname': $('#productname').val(),
               'packingtype': $('#packingtype').val(),
              'quantity': $('#quantity').val(),
              'price': $('#price').val(),
              'offerprice': $('#offerprice').val(),
              'rating': $('#rating').val(),
              'status': $('#status').val(),
                'productid': $('#productid').val(),

          }, function (data) {
                 if (data.result) {
                  $('.messagestyle').html('Record Update Successfully')
              } else {
                  $('.messagestyle').html('Fail to Update Record')
              }

          })
      })

         $('.delete').click(function () {

          $.getJSON('http://localhost:8000/deleteproducts',{
              'productid':$('#productid').val()

          },function (data) {
             if (data.result) {
                  $('.messagestyle').html('Record Deleted Successfully..')
              } else {
                  $('.messagestyle').html('Fail to Delete Record..')
              }

          })
      })

         $('.btnclose').click(function () {

             $('#modal1').modal('close');
             window.location.reload('http://localhost:8000/displayproducts')
         })

          $('.btniconclose').click(function () {
         alert('hello')

            $('#modal2').modal('close');
            window.location.reload('http://localhost:8000/displayproducts')

        })

          $('.imgbtn').click(function (){
         alert($(this).attr('piconid'))

            $('#icon_pid').val($(this).attr('piconid'))
            $('#modal2').modal('open')

            $('#icon').attr('src',`/static/${$(this).attr('pimage')}`)
        })

     });

      $('.iconbtn').click(function () {
      var formData = new FormData()
      alert($('#icon_pid').val())
      formData.append('productid', $('#icon_pid').val())
      var file = $('#newicon')[0].files
      if (file.length > 0)
          formData.append('producticon', file[0])

       $.ajax({
            url: '/editproducticon',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            type: 'post',
            data: formData,
            contentType: false,
            processData: false,
            success: function (response) {
                if (response != 0) {
                    alert
                    (true)
                } else {
                    alert(false)
                }
            }

        })

  })

</script>
</html>